<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>0-12ä¸ªæœˆå©´å„¿TOP30é—®é¢˜é€ŸæŸ¥æ‰‹å†Œ</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;line-height:1.6}
    .container{max-width:1200px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
    .header{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff;padding:30px;text-align:center}
    .header h1{font-size:28px;margin-bottom:10px}
    .header p{font-size:14px;opacity:.9}
    .search-box{padding:20px 30px;background:#f8f9fa;border-bottom:2px solid #e9ecef}
    .search-input{width:100%;padding:12px 20px;border:2px solid #e9ecef;border-radius:25px;font-size:15px;transition:.3s} 
    .search-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
    .month-tabs{display:flex;overflow-x:auto;background:#f8f9fa;padding:10px;gap:8px;border-bottom:2px solid #e9ecef;-webkit-overflow-scrolling:touch}
    .month-tabs::-webkit-scrollbar{height:6px}
    .month-tabs::-webkit-scrollbar-thumb{background:#667eea;border-radius:3px}
    .month-tab{flex-shrink:0;padding:12px 20px;background:#fff;border:2px solid #e9ecef;border-radius:25px;cursor:pointer;transition:.3s;font-size:14px;font-weight:500;white-space:nowrap}
    .month-tab:hover{border-color:#667eea;transform:translateY(-2px)}
    .month-tab.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border-color:transparent}
    .content{padding:30px}
    .section-header{margin-bottom:20px}
    .section-header h2{color:#764ba2;font-size:24px;margin-bottom:8px}
    .section-header .subtitle{color:#6c757d;font-size:14px}
    .category{margin-bottom:30px}
    .category-title{display:inline-block;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff;padding:8px 20px;border-radius:20px;font-size:16px;font-weight:600;margin-bottom:15px}
    .question-list{display:grid;gap:12px}
    .question-item{background:#f8f9fa;padding:15px 20px;border-radius:12px;cursor:pointer;transition:.3s;border:2px solid transparent;display:flex;align-items:center;gap:12px}
    .question-item:hover{background:#e9ecef;border-color:#667eea;transform:translateX(5px)}
    .question-number{flex-shrink:0;width:32px;height:32px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px}
    .question-text{flex:1;color:#212529;font-size:15px}

    /* Modal */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1000;padding:20px;overflow-y:auto;animation:fadeIn .3s}
    .modal.active{display:flex;align-items:center;justify-content:center}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-content{background:#fff;border-radius:20px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;animation:slideUp .3s}
    @keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .modal-header{background: linear-gradient(135deg,#4c1d95 0%,#7c3aed 100%);color: #fff;padding:25px;position:sticky;top:0;z-index:10}
    .modal-header h3{font-size: 24px;margin-bottom:8pxfont-weight:800;letter-spacing:.2px;text-shadow:0 1px 2px rgba(0,0,0,.25);}
    .question-tag{background:rgba(255,255,255,.18);padding:4px 12px;border-radius:14px;font-size:12px;display:inline-block;border:1px solid rgba(255,255,255,.3);backdrop-filter:saturate(140%) blur(2px)}
    .close-btn{position:absolute;top:20px;right:20px;width:36px;height:36px;background:rgba(255,255,255,.2);border:none;border-radius:50%;color:#fff;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.3s}
    .close-btn:hover{background:rgba(255,255,255,.3);transform:rotate(90deg)}
    .modal-body{padding:30px}
    /* Content styling inside modal */
    .modal-body .md h4{color:#4f46e5;font-size:17px;margin:20px 0 10px;display:flex;align-items:center;gap:8px;position:relative;padding-left:14px}.modal-body .md h4::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:18px;border-radius:2px;background:linear-gradient(180deg,#6366f1 0%,#8b5cf6 100%)}
    .modal-body .md p,.modal-body .md ul{color:#495057;font-size:15px;line-height:1.9;margin:10px 0 14px}
    .modal-body .md ul{list-style:none;padding-left:0}
    .modal-body .md li{padding-left:20px;position:relative;margin-bottom:8px}
    .modal-body .md li::before{content:'â€¢';position:absolute;left:0;color:#667eea;font-weight:bold}
    .mom-message{background:linear-gradient(135deg,#ffe5d2 0%,#ffc8ae 100%);border-radius:14px;box-shadow:0 10px 28px rgba(255,140,100,.28);padding:18px 20px;margin:16px 0;border:1px solid rgba(255,140,100,.35)}.mom-message h4{color:#9a3412;margin:0 0 8px 0;font-weight:700;padding-left:14px;position:relative;display:flex;align-items:center;gap:8px}.mom-message h4::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:18px;border-radius:2px;background:#fb923c}.mom-message p{color:#7c2d12;margin:8px 0}

    @media (max-width:768px){
      body{padding:10px}
      .header h1{font-size:22px}
      .content{padding:20px}
      .month-tab{padding:10px 16px;font-size:13px}
      .modal-content{margin:10px}
      .modal-body{padding:20px}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ‘¶ 0-12ä¸ªæœˆå©´å„¿TOP30é—®é¢˜é€ŸæŸ¥æ‰‹å†Œ</h1>
      <p>ä¸“ä¸šè‚²å„¿çŸ¥è¯† | å¿«é€ŸæŸ¥æ‰¾ | è´´å¿ƒè§£ç­”</p>
    </div>

    <div class="search-box">
      <input type="text" id="search" class="search-input" placeholder="ğŸ” æœç´¢é—®é¢˜å…³é”®è¯...">
    </div>

    <div class="month-tabs" id="monthTabs"></div>

    <div class="content" id="content"></div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close-btn" id="closeBtn">Ã—</button>
        <h3 id="modalTitle">æ ‡é¢˜</h3>
        <div class="question-tag" id="questionTag"></div>
      </div>
      <div class="modal-body">
        <div class="md" id="modalBody"></div>
      </div>
    </div>
  </div>

<script>
const state={raw:'', months:[], current:0, flatIndex:[]};
const el={
  monthTabs:document.getElementById('monthTabs'),
  content:document.getElementById('content'),
  search:document.getElementById('search'),
  modal:document.getElementById('modal'),
  closeBtn:document.getElementById('closeBtn'),
  modalTitle:document.getElementById('modalTitle'),
  questionTag:document.getElementById('questionTag'),
  modalBody:document.getElementById('modalBody')
};

async function boot(){
  try{
    const res=await fetch('./all_content.md.txt');
    state.raw=await res.text();
    parse(state.raw);
    renderTabs();
    setMonth(0);
  }catch(e){
    console.error(e);
    el.content.innerHTML = '<div style="padding:20px;color:#c00">åŠ è½½å¤±è´¥ï¼šè¯·ç¡®è®¤ä»“åº“æ ¹ç›®å½•å­˜åœ¨ <b>all_content.md.txt</b>ã€‚</div>';
  }
}

// Parser: supports full-width colon and first-question-at-start
function parse(md){
  const monthBlocks = md.split(/\n#\s*ã€Œ/).filter(Boolean).map((blk,i)=> (i?'ã€Œ'+blk:blk));
  state.months = monthBlocks.map(block=>{
    const titleLine = block.split(/\n/)[0].replace(/^#\s*/,''); // full first line
    const name = (titleLine.match(/ã€Œ([^ã€]+)ã€/i)||[])[1] || titleLine;

    const cats=[];
    const catSplit = block.split(/\n###\s*\*\*ã€([^ã€‘]+)ã€‘\*\*\s*/).slice(1);
    for(let i=0;i<catSplit.length;i+=2){
      const cname = catSplit[i];
      const cbody = catSplit[i+1]||'';
      const qs=[];
      const normalized = cbody.replace(/ï¼š/g, ':').replace(/\r/g,'');
      const parts = normalized.split(/(?:^|\n)####\s*\*\*é—®é¢˜\s*([0-9]+)\/[0-9]+:\s*([^*\n]+)\*\*\s*/).slice(1);
      for(let j=0;j<parts.length;j+=3){
        const idx = parts[j];
        const qtitle = parts[j+1];
        const rest = parts[j+2] || '';
        const nextBreak = rest.search(/\n####\s|\n###\s|\n#\s/);
        const content = nextBreak===-1? rest : rest.slice(0,nextBreak);
        if(qtitle){
          qs.push({idx:Number(idx), title:qtitle.trim(), content:content.trim(), cat:cname, month:name});
          state.flatIndex.push({month:name, cat:cname, title:qtitle.trim(), content:content.trim()});
        }
      }
      cats.push({name:cname, questions:qs});
    }
    return {name, cats};
  });
}

function renderTabs(){
  el.monthTabs.innerHTML = state.months.map((m,i)=>{
    let label = m.name.replace(/æœˆé¾„/g,'').replace(/[ï¼ˆï¼‰]/g,'');
    if(/^\d+$/.test(label)) label+='æœˆ';
    else if(/^\d+-\d+$/.test(label)) label+='ä¸ªæœˆ';
    return `<div class="month-tab ${i===state.current?'active':''}" data-i="${i}">${label}</div>`;
  }).join('');
  el.monthTabs.querySelectorAll('.month-tab').forEach(tab=>tab.addEventListener('click',()=> setMonth(Number(tab.dataset.i))));
}

function setMonth(i){
  state.current=i; renderTabs();
  const m=state.months[i];
  // Section header
  let html = `<div class="section-header"><h2>${m.name}</h2><div class="subtitle"></div></div>`;
  // Categories and questions
  m.cats.forEach(cat=>{
    if(!cat.questions.length) return;
    html += `<div class="category"><div class="category-title">${cat.name}</div><div class="question-list">`;
    cat.questions.forEach((q,k)=>{
      html += `<div class="question-item" data-month="${m.name}" data-title="${q.title}">
        <div class="question-number">${q.idx||k+1}</div>
        <div class="question-text">${q.title}</div>
      </div>`;
    });
    html += `</div></div>`;
  });
  el.content.innerHTML = html || '<div style="padding:20px;color:#6c757d">æœ¬æœˆæš‚æ— è§£æå†…å®¹ã€‚</div>';
  el.content.querySelectorAll('.question-item').forEach(div=>div.addEventListener('click',()=> openModal(div.dataset.title, div.dataset.month)));
}

function openModal(title, month){
  const it = state.flatIndex.find(x=>x.title===title && x.month===month) || state.flatIndex.find(x=>x.title===title);
  if(!it){
    el.modalTitle.textContent = title;
    el.questionTag.textContent = month||'';
    el.modalBody.innerHTML = '<div style="color:#c00">æœªæ‰¾åˆ°è¯¥é—®é¢˜æ­£æ–‡ã€‚</div>';
    return;
  }
  el.modalTitle.textContent = it.title;
  el.questionTag.textContent = `${it.month} Â· ${it.cat}`;

  let md = it.content;

  // æŠŠ "**å°èŠ‚å**ï¼š" æˆ– "- **å°èŠ‚å**ï¼š" å½’ä¸€åŒ–ä¸ºå››çº§æ ‡é¢˜ï¼Œæ–¹ä¾¿æ¢è¡Œæ˜¾ç¤º
  const secNames = ["ç°è±¡","ç°è±¡è§£æ","åŸå› ","åŸå› åˆ†æ","ä¸“å®¶å»ºè®®","ä¸“å®¶æŒ‡å—","è§£å†³æ–¹æ¡ˆ","å®æ“æ–¹æ³•","å®æ“","ç»™å¦ˆå¦ˆ&çˆ¸çˆ¸çš„è¯","ç»™å¦ˆå¦ˆ & çˆ¸çˆ¸çš„è¯","ç»™å¦ˆå¦ˆçš„è¯","ç»™çˆ¸çˆ¸å¦ˆå¦ˆçš„è¯"];
  secNames.forEach(name=>{
    const n = name.replace(/([.*+?^${}()|[\]\\])/g,'\\$1');
    md = md.replace(new RegExp(`\\n\\s*[-*]?\\s*\\*\\*${n}\\*\\*\\s*[ï¼š:]*\\s*`,'g'), `\n#### ${name}\n\n`);
  });

  el.modalBody.innerHTML = marked.parse(md);
  const container = el.modalBody;

  const addEmoji = (t)=>{
    if(/^(ç°è±¡|ç°è±¡è§£æ|åŸå› |åŸå› åˆ†æ)/.test(t)) return "ğŸ” "+t;
    if(/^(ä¸“å®¶å»ºè®®|ä¸“å®¶æŒ‡å—)/.test(t)) return "ğŸ‘¨â€âš•ï¸ "+t;
    if(/^(è§£å†³æ–¹æ¡ˆ|å®æ“æ–¹æ³•|å®æ“)/.test(t)) return "âœ… "+t;
    if(/ç»™å¦ˆå¦ˆ|ç»™çˆ¸çˆ¸/.test(t)) return "ğŸ’ "+t;
    return t;
  };

  // æ–¹æ¡ˆAï¼šæœ‰äº›æ–‡æ¡£ä»ç„¶æ˜¯â€œåˆ—è¡¨é¡¹ + åŠ ç²—å°èŠ‚åâ€ï¼ŒæŠŠè¿™æ ·çš„ ul åˆ†è§£ä¸ºç‹¬ç«‹åŒºå—
  container.querySelectorAll('ul').forEach(ul=>{
    const lis = Array.from(ul.children);
    const hasSection = lis.some(li=>{
      const first = li.querySelector('p, :scope>strong') || li.firstElementChild;
      const strong = first && (first.querySelector && first.querySelector('strong')) ? first.querySelector('strong') : (first && first.tagName==='STRONG' ? first : null);
      if(!strong) return false;
      const lab = strong.textContent.trim().replace(/\s+/g,'');
      return secNames.some(n=>n.replace(/\s+/g,'')===lab);
    });
    if(!hasSection) return;

    const frag = document.createDocumentFragment();
    lis.forEach(li=>{
      const first = li.querySelector('p, :scope>strong') || li.firstElementChild;
      const strong = first && (first.querySelector && first.querySelector('strong')) ? first.querySelector('strong') : (first && first.tagName==='STRONG' ? first : null);
      if(strong){
        const raw = strong.textContent.trim();
        const lab = raw.replace(/\s+/g,'');
        if(secNames.some(n=>n.replace(/\s+/g,'')===lab)){
          const h4 = document.createElement('h4');
          h4.textContent = addEmoji(raw);
          let wrap = null;
          if(/ç»™å¦ˆå¦ˆ|ç»™çˆ¸çˆ¸/.test(raw)){
            wrap = document.createElement('div'); wrap.className='mom-message';
            wrap.appendChild(h4);
          }else{
            frag.appendChild(h4);
          }
          // ä¸»ä½“æ–‡æœ¬ï¼ˆå»æ‰åŠ ç²—æ ‡ç­¾ä¸å†’å·ï¼‰
          const target = first;
          const restHTML = target.innerHTML.replace(/^\s*<strong>.*?<\/strong>\s*[ï¼š:]?\s*/,'').trim();
          if(restHTML){
            const p = document.createElement('p'); p.innerHTML = restHTML;
            (wrap||frag).appendChild(p);
          }
          // li å†…å…¶ä½™èŠ‚ç‚¹ä¹Ÿæ¥åˆ°åé¢
          Array.from(li.childNodes).forEach(n=>{
            if(n===first) return;
            (wrap||frag).appendChild(n);
          });
          if(wrap) frag.appendChild(wrap);
          return; // handled
        }
      }
      // éå°èŠ‚é¡¹ï¼šä¿ç•™ä¸ºå­åˆ—è¡¨ï¼ŒæŒ‚åˆ°å‰ä¸€ä¸ªå°èŠ‚ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™ç›´æ¥é™„åŠ 
      if(frag.lastChild && (frag.lastChild.classList && !frag.lastChild.classList.contains('mom-message')) || (frag.lastChild && frag.lastChild.tagName==='H4')){
        // å¦‚æœæœ€åä¸€ä¸ªæ˜¯ h4ï¼ŒæŠŠå®ƒåé¢ç”Ÿæˆä¸€ä¸ªå®¹å™¨
        if(frag.lastChild.tagName==='H4'){
          const div = document.createElement('div');
          frag.appendChild(div);
        }
      }
      frag.appendChild(li);
    });
    ul.replaceWith(frag);
  });

  // æ–¹æ¡ˆBï¼šè‹¥ä»æœ‰æ®µè½å½¢æ€çš„ "**å°èŠ‚å**ï¼š"ï¼Œä¹Ÿæå‡ä¸º h4 + p
  container.querySelectorAll('p').forEach(p=>{
    const first = p.firstElementChild;
    if(first && first.tagName==='STRONG'){
      const raw = first.textContent.trim();
      const lab = raw.replace(/\s+/g,'');
      if(secNames.some(n=>n.replace(/\s+/g,'')===lab)){
        const h4 = document.createElement('h4');
        h4.textContent = addEmoji(raw);
        p.parentNode.insertBefore(h4, p);
        p.innerHTML = p.innerHTML.replace(/^\s*<strong>.*?<\/strong>\s*[ï¼š:]?\s*/,'').trim();
        if(!p.textContent.trim()) p.remove();
      }
    }
  });

  // ç»™æ‰€æœ‰ h4 åŠ  emojiï¼ˆå…œåº•ï¼‰
  container.querySelectorAll('h4').forEach(h=>{
    const t = h.textContent.trim();
    if(!/^[ğŸ”ğŸ‘¨â€âš•ï¸âœ…ğŸ’]/.test(t)) h.textContent = addEmoji(t);
  });

  // æŠŠâ€œç»™å¦ˆå¦ˆ & çˆ¸çˆ¸çš„è¯â€å—åŒ…æˆæš–æ©™å¡ç‰‡ï¼ˆå…œåº•ï¼‰
  container.querySelectorAll('h4').forEach(h=>{
    const t = h.textContent.replace(/^[ğŸ”ğŸ‘¨â€âš•ï¸âœ…ğŸ’]\s*/,'').trim();
    if(/ç»™å¦ˆå¦ˆ|ç»™çˆ¸çˆ¸/.test(t) && !h.closest('.mom-message')){
      const wrap = document.createElement('div'); wrap.className = 'mom-message';
      wrap.appendChild(h.cloneNode(true));
      let n = h.nextSibling;
      while(n && !(n.nodeType===1 && n.tagName==='H4')){
        const next = n.nextSibling; wrap.appendChild(n); n = next;
      }
      h.replaceWith(wrap);
    }
  });

  el.modal.scrollTop = 0;
  el.modal.classList.add('active');
}

function closeModal(){ el.modal.classList.remove('active'); document.body.style.overflow='auto'; }
el.closeBtn.addEventListener('click', closeModal);
el.modal.addEventListener('click', e=>{ if(e.target===el.modal) closeModal(); });
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

// Search (global)
el.search.addEventListener('input',()=>{
  const q = el.search.value.trim().toLowerCase();
  if(!q){ setMonth(state.current); return; }
  const hits = state.flatIndex.filter(x=> (x.title+x.cat+x.month).toLowerCase().includes(q));
  let html = `<div class="section-header"><h2>æœç´¢ç»“æœï¼ˆ${hits.length}ï¼‰</h2><div class="subtitle">ç‚¹å‡»æ¡ç›®æŸ¥çœ‹è¯¦ç»†è§£ç­”</div></div>`;
  html += `<div class="category"><div class="question-list">`;
  hits.forEach((x,i)=>{
    html += `<div class="question-item" data-title="${x.title}" data-month="${x.month}">
      <div class="question-number">${i+1}</div>
      <div class="question-text">${x.title}<div style="color:#6c757d;font-size:12px;margin-top:4px">${x.month} Â· ${x.cat}</div></div>
    </div>`;
  });
  html += `</div></div>`;
  el.content.innerHTML = html;
  el.content.querySelectorAll('.question-item').forEach(div=>div.addEventListener('click',()=> openModal(div.dataset.title, div.dataset.month)));
});

boot();
</script>
</body>
</html>
